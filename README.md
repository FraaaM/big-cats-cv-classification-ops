# big-cats-cv-classification-ops

Panthera Vision — это end-to-end MLOps проект для классификации и поиска изображений больших кошек (род Panthera). Проект использует дообученную модель EfficientNetV2 (fine-tuned) для классификации и генерации векторных представлений (эмбеддингов), а управление жизненным циклом данных и обучения осуществляется через пайплайн DVC (Data Version Control).

## Важно
### Убедитись что путь к репозиторию не содержит символов КИРИЛИЦЫ иначе при запуске dvc (dvc repro) возникнет ошибка из-за особенностей устройства dvc 
#### (PS. так как у меня инициализирован dvc (dvc init -f  --subdir) в поддиректрории корневой папки, где лежит .git, то из-за этого и возникает ошибка. Если бы .dvc был создан в корнейвой папке репозитория, рядом с .git, ошибок из-за кирилицы бы небыло)

## Проект состоит из двух основных модулей:
0. Тестовая реализация на jupyter-notebook
1. Пайплайн классификации: Обучение модели с управлением через DVC
2. Микросервис для поиска визуально похожих объектов с использованием FAISS.

### Модель обучена различать 5 конкретных видов на основе данных из iNaturalist:

#### Лев (Panthera leo)
#### Тигр (Panthera tigris)
#### Ягуар (Panthera onca)
#### Леопард (Panthera pardus)
#### Снежный барс (Panthera uncia)

## Структура проекта
Репозиторий организован по принципу монорепозитория и содержит два отдельных проекта:
```bash
├── cv-classification-dvc-pipeline/    # Основной проект обучения (DVC)
|   ├── data/                   # Датасеты ниже игнорируются git
│   │     ├──data_from_iNaturalist/observations.csv
│   │     ├──dataset.csv
│   │     └──dataset_images/... # папки с классами изображений                           
│   ├── models/                        # Сохраненные модели (игнорируются git)
│   ├── src/                           # Исходный код (обучение, подготовка, загрузка)
│   ├── dvc.yaml                       # Конфигурация пайплайна DVC
│   ├── params.yaml                    # Гиперпараметры и настройки
│   └── web_app.py                     # Демо-приложение классификации
│
└── image-search-dvc-pipeline/         # Микросервис поиска
    ├── faiss_index/                   # Векторная база данных
    ├── model_weights/                 # Копия обученной модели из cv-classification-dvc-pipeline
    ├── build_index.py                 # Скрипт создания векторного индекса
    └── web_app.py                     # Демо-приложение поиска
```

## Модуль 1: Пайплайн классификации (DVC)

### Запуск пайплайна DVC
Весь жизненный цикл управляется файлом `dvc.yaml`. 
```bash
cd cv-classification-dvc-pipeline
dvc repro
```

**Этапы пайплайна:**
1.  `prepare`: Очистка сырых данных CSV, полученных из iNaturalist.
2.  `download`: Загрузка изображений (с использованием кэширования `persist: true`).
3.  `train`: Дообучение (Fine-tuning) **EfficientNetV2-S**. Сохраняется лучшая модель на основе глобальной точности валидации.
4.  `evaluate`: Генерация матрицы ошибок и отчета о классификации на отложенной тестовой выборке.

###  Запуск демо-приложения
Запуск интерфейса Streamlit для классификации изображений:
```bash
streamlit run web_app.py
```
## Результаты и метрики

Процесс обучения использует валидационную выборку для обеспечения надежности модели и предотвращения переобучения.
*   **Global Best Accuracy:** Сохраняется в файле `results/training_history.json`.
*   **Confusion Matrix:** Генерируется после этапа оценки для анализа ошибок классификации (например, частота путаницы между Ягуаром и Леопардом).

Для просмотра метрик через DVC:
```bash
dvc metrics show
dvc plots show
```
---

## Модуль 2: Поиск похожих изображений (DVC)

Это автономный проект, который использует обученную модель в качестве экстрактора признаков (Feature Extractor) и библиотеку FAISS для быстрого векторного поиска. Он позволяет находить визуально похожие изображения

### 1. Инициализация данных
Необходимо предоставить обученную модель:
Скопируйте `best_model.pth` из основного проекта dvc в `image_search/model_weights/`.

### 2. Запуск пайплайна DVC
Перейдите в директорию поиска:
```bash
cd image_search
dvc repro
```
### Запуск приложения поиска
Загрузите изображение, чтобы найти топ-10 похожих объектов в базе данных:
```bash
streamlit run web_app.py
```
---

## Стек технологий

*   **Deep Learning:** PyTorch, Torchvision (EfficientNetV2, Transfer Learning).
*   **MLOps:** DVC (Data Version Control), Git.
*   **Computer Vision:** PIL, OpenCV.
*   **Vector Search:** FAISS (Facebook AI Similarity Search).
*   **Data Processing:** Pandas, NumPy.
*   **Visualization & UI:** Streamlit, Matplotlib, Seaborn.
